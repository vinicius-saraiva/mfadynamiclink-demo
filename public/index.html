<!DOCTYPE html>
<html>
<head>
    <style>
        .container { max-width: 600px; margin: 40px auto; padding: 20px; }
        .payment-details { 
            background: #f5f5f5; 
            padding: 15px; 
            margin: 20px 0;
            border-radius: 5px;
        }
        .warning { color: #ff4444; }
        .info { color: #4444ff; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Secure Payment Authorization Demo</h2>
        <p class="info">This demo shows how MFA is dynamically linked to payment details. 
           If you modify the amount or beneficiary after generating the MFA challenge, the authorization will fail.</p>

        <form id="paymentForm">
            <div>
                <label for="amount">Amount ($):</label>
                <input type="number" id="amount" required min="1" step="0.01">
            </div>
            <div style="margin-top: 10px;">
                <label for="beneficiaryId">Beneficiary ID:</label>
                <input type="text" id="beneficiaryId" required>
            </div>
            <button type="submit" style="margin-top: 20px;">Authorize Payment</button>
        </form>

        <div class="payment-details" id="paymentDetails" style="display: none;">
            <h3>Payment Details Being Authorized:</h3>
            <p>Amount: $<span id="confirmedAmount"></span></p>
            <p>Beneficiary: <span id="confirmedBeneficiary"></span></p>
            <p class="warning">⚠️ Any attempt to modify these details after MFA generation will invalidate the authorization.</p>
        </div>
    </div>

    <script>
        document.getElementById('paymentForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const amount = document.getElementById('amount').value;
            const beneficiaryId = document.getElementById('beneficiaryId').value;

            try {
                const response = await fetch('/api/payment/authorize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 'test-user-123',
                        amount: amount,
                        beneficiaryId: beneficiaryId
                    })
                });

                const data = await response.json();
                console.log('Server response:', data);

                if (data.requiresChallenge && data.challengeUrl) {
                    // Display the payment details being authorized
                    document.getElementById('paymentDetails').style.display = 'block';
                    document.getElementById('confirmedAmount').textContent = amount;
                    document.getElementById('confirmedBeneficiary').textContent = beneficiaryId;

                    // Store the original values in sessionStorage
                    sessionStorage.setItem('originalAmount', amount);
                    sessionStorage.setItem('originalBeneficiary', beneficiaryId);

                    // Redirect to MFA challenge after a short delay to allow reading the details
                    setTimeout(() => {
                        window.location.replace(data.challengeUrl);
                    }, 2000);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error during authorization: ' + error.message);
            }
        };
    </script>
</body>
</html> 